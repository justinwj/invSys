# Recipe List Builder (Production)

This doc captures the current Recipe List Builder flow in the Production sheet and how process tables + templates are saved.

## What exists now
- Header table: `RB_AddRecipeName` (RECIPE_NAME, DESCRIPTION, GUID, RECIPE_ID)
- Lines table: `RecipeBuilder` / `RB_BuildRecipe` (PROCESS, DIAGRAM_ID, INPUT/OUTPUT, INGREDIENT, PERCENT, UOM, AMOUNT, OOO, INSTRUCTION, RECIPE_LIST_ROW, INGREDIENT_ID, GUID)
- Process tables: `proc_<n>_rbuilder` (sequence number, autogenerated)
- Templates: `TemplatesTable` (scope = `RECIPE_PROCESS`, process + column formulas)

## Builder flow (save/load + templates)

```mermaid
flowchart TD
    classDef btn fill:#2f4e9c,stroke:#1f2f5c,color:#ffffff;
    classDef list fill:#2c7a9b,stroke:#195a73,color:#ffffff;
    classDef data fill:#8c6239,stroke:#4f341f,color:#ffffff;
    classDef note fill:#fff2cc,stroke:#b99a33,color:#000000;

    LoadBtn["Load Recipe"]:::btn
    BuildBtn["Add Recipe Process Table"]:::btn
    RemoveBtn["Remove Recipe Process Table"]:::btn
    ClearBtn["Clear Recipe List Builder"]:::btn
    SaveBtn["Save Recipe"]:::btn

    Header["RB_AddRecipeName\n(RECIPE_NAME | DESCRIPTION | GUID | RECIPE_ID)"]:::list
    Lines["RecipeBuilder / RB_BuildRecipe\n(PROCESS | DIAGRAM_ID | INPUT/OUTPUT | INGREDIENT | PERCENT | UOM | AMOUNT | OOO | INSTRUCTION | RECIPE_LIST_ROW | INGREDIENT_ID | GUID)"]:::list
    ProcTables["proc_<n>_rbuilder\n(sequence tables)\n(formulas live here)"]:::list

    Recipes["Recipes table"]:::data
    Templates["TemplatesTable\n(TEMPLATE_SCOPE=RECIPE_PROCESS)\n(PROCESS | TARGET_TABLE | TARGET_COLUMN | FORMULA)"]:::data

    LoadBtn --> Header --> Lines
    Lines --> BuildBtn --> ProcTables
    ProcTables --> RemoveBtn
    ProcTables --> ClearBtn
    ProcTables --> SaveBtn --> Recipes
    SaveBtn --> Templates

    Note1["Save uses process tables if present;\notherwise falls back to lines table."]:::note
    Note2["If no PROCESS rows exist, Add creates a blank\nprocess table; user fills PROCESS column."]:::note
    Note3["Ctrl-click one or more process tables,\nthen use Remove to delete."]:::note
    Note4["Clear removes process tables and\nclears RB_AddRecipeName + RecipeBuilder lines."]:::note
    ProcTables -.-> Note1
    ProcTables -.-> Note2
    ProcTables -.-> Note3
    ProcTables -.-> Note4
```

## Process table build (per PROCESS)

```mermaid
flowchart TD
    classDef op fill:#2c7a9b,stroke:#195a73,color:#ffffff;
    classDef data fill:#8c6239,stroke:#4f341f,color:#ffffff;
    classDef note fill:#fff2cc,stroke:#b99a33,color:#000000;

    Scan["Scan RecipeBuilder rows"]:::op
    Group["Group by PROCESS"]:::op
    Create["Create proc_<process>_rbuilder tables"]:::op
    ApplyTpl["Apply TemplatesTable formulas\n(scope + recipe + process)"]:::op

    Scan --> Group --> Create --> ApplyTpl

    Note2["Process tables are stacked under\nRB_AddRecipeName in the same columns,\nwith 2 blank rows between tables."]:::note
    Create -.-> Note2
```

## Notes / conventions
- Process tables are named `proc_<n>_rbuilder` (sequence number, auto-generated).
- Users enter the process name in the PROCESS column after the table is created.
- Process table headers: PROCESS, DIAGRAM_ID, INPUT/OUTPUT, INGREDIENT, PERCENT, UOM, AMOUNT, OOO, INSTRUCTION, RECIPE_LIST_ROW, INGREDIENT_ID, GUID.
- The PROCESS column in each process table stores the original process name (used for template filtering).
- `Save Recipe` deletes existing rows for the RECIPE_ID, then writes concatenated rows from all process tables.
- Template rows are replaced per RECIPE_ID + TEMPLATE_SCOPE when saving.
- Template scope constant: `RECIPE_PROCESS`.
- RB_AddRecipeName is always present on the sheet (header table).
- Add/Remove buttons manage the process tables (build from lines, delete selected tables).
- Clear Recipe List Builder removes process tables and clears RB_AddRecipeName + RecipeBuilder lines.
- Process tables are anchored under RB_AddRecipeName with 2 blank rows between tables.
- Banding/row-shift logic will be needed so process tables can expand/contract without colliding with other systems.
